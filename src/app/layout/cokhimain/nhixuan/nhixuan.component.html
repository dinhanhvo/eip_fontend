<p-messages [(value)]="msgs"></p-messages>
<!-- <p>nhixuan works!</p> -->
<p-tabView (onChange)="onTabChange($event)">
    <!-- tab 1 - Xuất -->
    <p-tabPanel header="Xuất" [selected]="true">
        <!-- export Form -->
        <div class="row">
            <div class="p-col-6">
                <br>
                <div class="p-grid" class="row">
                    <div class="p-col-4 label" style="text-align: right;">
                        Chọn thuốc:
                    </div>
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <p-dropdown [options]="thuocs" optionLabel="maThuoc"
                                 [(ngModel)]="selectedThuoc"
                                placeholder="Mã thuốc" filter="true"
                                 (onChange)="changeThuocXuat()">
                            </p-dropdown>
                        </span>
                    </div>
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <p-dropdown [options]="thuocs" optionLabel="tenThuoc"
                             [(ngModel)]="selectedThuoc"
                                placeholder="Tên thuốc" filter="true"
                                 (onChange)="changeThuocXuat()">
                            </p-dropdown>
                        </span>
                    </div>
                </div>
                <br>
                <!-- Kho-MaLo -->
                <div class="p-grid" class="row">
                    <div class="p-col-4 label" style="text-align: right;">
                        Kho:
                    </div>
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <p-dropdown [options]="khoNhaps" optionLabel="name"
                                 name="khoNhap" [(ngModel)]="selectedKhoXuat"
                                (onChange)="changeKhoXuat()">
                            </p-dropdown>
                        </span>
                    </div>
                    <div class="p-col-4" class="label">
                        <!-- <p-dropdown [options]="listMaLo" optionLabel="maphieu"
                            name="malo" [(ngModel)]="selectedMalo"
                            (onChange)="changeMaLo()">
                        </p-dropdown> -->
                        <div *ngIf="selectedMalo">
                            {{selectedMalo.maphieu}}
                        </div>
                    </div>
    
                </div>
                <br>
                <!-- Số lượng Xuất: -->
                <div class="p-grid" class="row">
                    <div class="p-col-4 label" style="text-align: right;">
                        Số lượng Xuất:
                    </div>
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <input  type="text"  
                            pInputText [(ngModel)]="phieuExportModel.soluongxuat"
                                pKeyFilter="pnum" (keyup)="changeSoluongXuat()">
                            <label for="float-input">{{phieuExportModel.soluongxuat | number}} {{selectedThuoc.unit}}</label>
                        </span>
                        <!-- <label class="pipe">{{phieuExportModel.soluongxuat | number}} {{selectedThuoc.unit}}</label> -->
                    </div>
                    <!-- <div class="p-col-2 label" style="text-align: right;">
                    </div> -->
                    <div class="p-col-4">
                        <!-- <div class="p-col-3"> -->
                            <span class="ui-float-label">
                                <p-dropdown [options]="khuXuats" optionLabel="name" name="khuXuat"
                                    palaceholder="Chọn khu"
                                     [(ngModel)]="selectedKhuXuat"
                                    (onChange)="changeKhu()">
                                </p-dropdown>
                            </span>
                        <!-- </div> -->
                    </div>
                    <div class="p-col-2" *ngIf="selectedMalo">
                        <label for="float-input">{{selectedMalo.location}}</label>
                    </div>
                </div>
                <br>
                <!-- Ngày -->
                <div class="p-grid" class="row">
                    <div class="p-col-4 label" style="text-align: right;">
                        Ngày Xuất
                    </div>
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <p-calendar [(ngModel)]="phieuExportModel.exported_at" dateFormat="dd/mm/yy" [showIcon]="true">
                            </p-calendar>
                        </span>
                    </div>
                    <!-- <div class="p-col-3">
                            <span class="ui-float-label">
                                <p-calendar [(ngModel)]="phieu.ngaysx"   
                                dateFormat="dd/mm/yy"
                                [showIcon]="true"></p-calendar>
                            </span>
                        </div> -->
                    <div class="p-col-4">
                        <span class="ui-float-label">
                            <textarea  type="text" size="60" pInputTextarea
                                [(ngModel)]="phieuExportModel.description"> </textarea>
                            <label for="float-input">Diễn giải</label>
                        </span>
                    </div>
                </div>
            </div>
            <div class="p-col-4 row" style="background-color: aqua;">
                <div class="p-col-4" >
                    <div *ngIf="listMaLo.length > 0">
                        Danh sách lô còn:
                        <p-listbox [options]="listMaLo" 
                            [(ngModel)]="selectedMalo" 
                            (onChange)="changeMaLo()"
                            optionLabel="maphieu">
                        </p-listbox>
                    </div>
                </div>
                <div class="p-col-2"></div>
                <div class="p-col-6 " *ngIf="selectedMalo && selectedThuoc">
                    <div>
                        <div *ngIf="selectedMalo">
                            Đã chọn Lô: <br>
                            <b>{{selectedMalo.maphieu}}</b>
                        </div>
                    </div>
                    <div class="row">
                        <div class="p-col-4" >
                            Tồn cũ: 
                            <label class="pipe"><b>{{selectedMalo.soluongton | number}}</b> {{selectedThuoc.unit}}</label>
                        </div>
                        <div class="p-col-4" *ngIf="selectedMalo">
                            Tồn mới:  
                            <label class="pipe"><b>{{tonmoi | number}}</b> {{selectedThuoc.unit}}</label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="shadow-lg card p-col-2" style="background-color: aquamarine;">
                <br>
                <div *ngIf="selectedMalo && selectedThuoc">
                    <!-- <div class="p-col-2"> -->
                        Tổng tồn:
                        <label class="pipe"> <b> {{toncu | number}} </b> {{selectedThuoc.unit}}</label>
                    <!-- </div> -->
                    <!-- <div class="p-col-2" >
                        Tồn cũ: <b>{{selectedMalo.soluongton | number}}</b>
                    </div>
                    <div class="p-col-2" *ngIf="selectedMalo">
                        Tồn mới:  <b>{{tonmoi | number}}</b>
                    </div> -->
                </div>

            </div>
        </div>
        <br>
        <div class="p-grid p-col-12">
            <p-button style="float: right;" label="Xuất" (onClick)="xuat()" 
                class="ui-button-rounded"></p-button>
        </div>
        <!-- export table -->
        <br>
        <div class="p-grid">
            <p-table #dtXuat [columns]="colsExport" [value]="listExportModel" 
                [autoLayout]="true"
                [loading]="searching"
                selectionMode="single" 
                [(selection)]="exSelected" (onRowSelect)="onExportRowSelect()"
                 [paginator]="true" [rows]="25">
                <ng-template pTemplate="caption">
                    Chi tiết danh sách đã xuất 
                    <!-- <div *ngIf="name">{{name}}, tổng: {{importTotal}}  </div> -->
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                    </tr>
                    <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field">
                          <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                          <!-- <input *ngSwitchCase="'donthuocjs'" pInputText type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')"> -->
                          <input *ngSwitchCase="'maphieu'" pInputText type="text"
                            (input)="dtXuat.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                          (input)="dtXuat.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'kho_name'" pInputText type="text"
                            (input)="dtXuat.filter($event.target.value, col.field, 'contains')">
                            <input *ngSwitchCase="'khu_name'" pInputText type="text"
                            (input)="dtXuat.filter($event.target.value, col.field, 'contains')">
                            <input *ngSwitchCase="'loxuatId'" pInputText type="text"
                            (input)="dtXuat.filter($event.target.value, col.field, 'contains')">
                        </th>
                      </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td *ngFor="let col of columns">
                            <div *ngIf="col.field=='exported_at'">
                                {{rowData[col.field] | date:'dd/MM/yyy'}}
                            </div>
                            <div *ngIf="col.field!='exported_at'">
                                {{rowData[col.field]}}
                            </div>

                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <!-- export Dialog to Edit-->
        <div>
            <p-dialog header="Chi tiết xuất " 
                [(visible)]="displayExportDialog" 
                [focusOnShow]="false" [responsive]="true" showEffect="fade" [modal]="true"  
                [style]="{width: '500px'}">
                <div class="ui-g ui-fluid" *ngIf="exSelected">
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="vin">Mã phiếu</label>
                        </div>
                        <div class="ui-g-8">
                            <label>
                                {{exSelected.maphieu}}
                            </label>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="vin">Tên thuốc: </label>
                        </div>
                        <div class="ui-g-8">
                            <label>
                                {{exSelected.tenthuoc}}
                            </label>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="vin">Số lượng xuất: </label>
                        </div>
                        <div class="ui-g-8">
                            <span class="ui-float-label">
                                <input  type="text"  
                                pInputText [(ngModel)]="exSelected.soluongxuat"
                                    [disabled]="toncu > 0"
                                    pKeyFilter="pnum" (keyup)="changeSoluongXuat()">
                                <label for="float-input">{{exSelected.soluongxuat | number}} {{selectedThuoc.unit}}</label>
                            </span>
                        </div>
                    </div>
                    
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label >Ngày Xuất: </label>
                        </div>
                        <div class="ui-g-8">
                            <label>
                                {{exSelected.exported_at | date: 'dd/MM/yyy'}}
                            </label>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label>Nơi lấy</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="exSelected.location" />
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="year">Diễn giải</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="exSelected.description" />
                        </div>
                    </div>
                    <!-- <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="color">Hình ảnh</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText [(ngModel)]="imSelected.imagepath" />
                        </div>
                    </div> -->
                </div>
                <p-footer>
                    <div class="ui-dialog-buttonpane ui-helper-clearfix">
                        <button type="button" pButton 
                            icon="fa fa-close" (click)="delete(false)" label="Delete"></button>
                        <button type="button" pButton 
                            icon="fa fa-check" (click)="updatePhieu(true)" label="Save"></button>
                    </div>
                </p-footer>
            </p-dialog>
        </div>
    </p-tabPanel>

    <!-- Nhập View -->
    <p-tabPanel header="Nhập" >
        <!-- Form Nhap -->
        <div>
            <br>
            <div class="p-grid">
                <div class="p-col-2 label"  style="text-align: right;" >
                    Chọn thuốc: 
                </div>
                <div class="p-col-2">
                    <span class="ui-float-label">
                        <p-dropdown [options]="thuocs" optionLabel="maThuoc"
                        [(ngModel)]="selectedThuoc"
                            placeholder="Chọn theo mã thuốc" filter="true"
                            (onChange)="changeThuoc()" >
                        </p-dropdown>
                    </span>
                </div>
                <div class="p-col-2">
                    <span class="ui-float-label">
                        <p-dropdown [options]="thuocs" optionLabel="tenThuoc"
                            [(ngModel)]="selectedThuoc"
                            placeholder="Chọn theo tên thuốc" filter="true"
                            (onChange)="changeThuoc()" >
                        </p-dropdown>
                    </span>
                </div>
                <div class="p-col-3">
                    <span class="ui-float-label">
                        <p-dropdown [options]="khoNhaps"
                        optionLabel="name" name="khoNhap"
                        [(ngModel)]="selectedKhoNhap"
                            (onChange)="changeKho()" >
                        </p-dropdown>
                    </span>
                </div>
                <div class="p-col-3 row" *ngIf="selectedKhoNhap && selectedThuoc">
                    <div class="p-col-6" >
                        <!-- Mã:  <b>{{phieuImportModel.maphieu}}</b> -->
                        Tồn cũ:  
                        <label class="pipe"><b>{{toncu | number}}</b> {{selectedThuoc.unit}}</label>
                    </div>
                    <div class="p-col-6">
                        Tồn mới: 
                        <label class="pipe"> <b>{{tonmoi | number}}</b> {{selectedThuoc.unit}}</label>
                    </div>
                </div>
            </div>

            <br>
            <!-- Số lượng nhập: -->
            <div class="p-grid">
                <div class="p-col-2 label" style="text-align: right;" >
                    Số lượng nhập:
                </div>
                <div class="p-col-2">
                    <span class="ui-float-label">
                        <input  type="text"  pInputText 
                        [(ngModel)] = "phieuImportModel.soluongnhap"
                        pKeyFilter="pnum"
                        (keyup)="changeSoluongNhap()"
                        
                        > 
                        <label for="float-input">Số lượng nhập</label>
                    </span>
                    <label class="pipe">{{phieuImportModel.soluongnhap | number}} {{selectedThuoc.unit}}</label>
                </div>
                <div class="p-col-2 label" style="text-align: right;" >
                    <!-- Diễn giải: -->
                </div>
                <div class="p-col-3">
                    <span class="ui-float-label">
                        <textarea  type="text" size="60" pInputTextarea
                        [(ngModel)] = "phieuImportModel.description"
                        > </textarea>
                        <label for="float-input">Diễn giải</label>
                    </span>                
                </div>
                <div class="p-col-3">
                    <span class="ui-float-label">
                        <input  type="text" pInputText 
                        [(ngModel)] = "phieuImportModel.location"
                        > 
                        <label for="float-input">Nơi lưu trữ</label>
                    </span>
                </div>
            </div>
            <!-- <br> -->
            <!-- Ngày -->
            <div class="p-grid">
                <div class="p-col-2 label"  style="text-align: right;" >
                </div>
                <!-- <div class="p-col-2">
                </div> -->
                <div class="p-col-4">
                    
                </div>
                <div class="p-col-3">
                    Ngày hết hạn
                </div>
                <div class="p-col-2">
                    <!-- Tổng tồn: 
                    <label class="pipe">{{tonTotal | number}} {{selectedThuoc.unit}}</label> -->
                </div>
            </div>
            <div class="p-grid">
                <div class="p-col-2 label" style="text-align: right;" >
                        Ngày Nhập: 
                </div>
                <div class="p-col-4">
                    <span class="ui-float-label">
                        <p-calendar [(ngModel)]="phieuImportModel.imported_at"   
                        dateFormat="dd/mm/yy"
                        [showIcon]="true"></p-calendar>
                    </span>
                </div>
                <div class="p-col-3">
                    <span class="ui-float-label">
                        <p-calendar [(ngModel)]="phieuImportModel.ngayhh"   
                        dateFormat="dd/mm/yy"
                        [showIcon]="true"></p-calendar>
                    </span>
                </div>
            </div>
            <br>
            <div class="p-grid p-col-12">
                <!-- <div class="p-col-2" ></div> -->
                <div class="p-col-12">
                    <p-button style="float: right;" label="Nhập" (onClick)="nhap($event)" class="ui-button-rounded"></p-button>
                </div>
            </div>
        </div>
        <!-- import table -->
        <br>
        <!-- table -->
        <div class="p-grid">
            <p-table #dtNhap [columns]="colsImport"
                [loading]="searching"
                [autoLayout]="true"
                 [value]="listImportModel" selectionMode="single" 
                [(selection)]="imSelected" (onRowSelect)="onImportRowSelect()" 
                [paginator]="true" [rows]="25">
                <ng-template pTemplate="caption">
                    Chi tiết danh sách đã nhập 
                    <!-- <div *ngIf="name">{{name}}, tổng: {{importTotal}}  </div> -->
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                    </tr>
                    <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field">
                          <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                          <input *ngSwitchCase="'id'" pInputText type="text"
                            (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'maphieu'" pInputText type="text"
                            (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                          (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'kho_name'" pInputText type="text"
                            (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                        </th>
                      </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td *ngFor="let col of columns">
                            <div *ngIf="col.field=='imported_at' || col.field=='ngayhh'">
                                {{rowData[col.field] | date:'dd/MM/yyy'}}
                            </div>
                            <div *ngIf="col.field!='imported_at' && col.field!='ngayhh'">
                                {{rowData[col.field]}}
                            </div>

                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
        <!-- import Dialog -->
        <div>
            <p-dialog header="Chi tiết nhập " 
                [(visible)]="displayImportDialog" [focusOnShow]="false"
                 [responsive]="true" showEffect="fade" [modal]="true" 
                  [style]="{width: '500px'}">
                <div class="ui-g ui-fluid" *ngIf="imSelected">
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="vin">Mã phiếu</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [disabled]="true"
                                [(ngModel)]="imSelected.maphieu" autofocus />
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="vin">Tên thuốc: </label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [disabled]="true"
                            [(ngModel)]="imSelected.tenthuoc"  />
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="imdate">Ngày nhập: </label>
                        </div>
                        <div class="ui-g-8">
                            <!-- dont change ngaynhap -->
                            {{imSelected.imported_at | date: 'dd/MM/yyyy'}}
                            <!-- <span class="ui-float-label">
                                <p-calendar [(ngModel)]="imSelected.imported_at"   
                                dateFormat="dd/mm/yy"
                                [showIcon]="true"></p-calendar>
                            </span> -->
                        </div>
                    </div>

                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label >Ngày hết hạn: </label>
                        </div>
                        <div class="ui-g-8">
                            <!-- <span class="ui-float-label">
                                <p-calendar [(ngModel)]="imSelected.imported_at"   
                                dateFormat="dd/mm/yy"
                                [showIcon]="true"></p-calendar>
                            </span> -->
                            {{imSelected.ngayhh | date: 'dd/MM/yyyy'}}
                        </div>
                    </div>

                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="imdate">Kho: </label>
                        </div>
                        <div class="ui-g-8">
                            <span class="ui-float-label">
                                <p-dropdown [options]="khoNhaps"
                                    optionLabel="name" name="khoNhapE"
                                    [(ngModel)]="selectedKhoNhap"
                                    (onChange)="changeKho()" >
                                </p-dropdown>
                            </span>
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="year">Nơi lưu trữ</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="imSelected.location" />
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="year">Diễn giải</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="imSelected.description" />
                        </div>
                    </div>
                    <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="brand">Số lượng</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="imSelected.soluongnhap" />
                        </div>
                    </div>
                    <!-- <div class="ui-g-12">
                        <div class="ui-g-4">
                            <label for="color">Hình ảnh</label>
                        </div>
                        <div class="ui-g-8">
                            <input pInputText  [(ngModel)]="imSelected.imagepath" />
                        </div>
                    </div> -->
                </div>
                <p-footer>
                    <div class="ui-dialog-buttonpane ui-helper-clearfix">
                        <button type="button" pButton icon="fa fa-close" (click)="delete(true)" label="Delete"></button>
                        <button type="button" pButton icon="fa fa-check" (click)="updatePhieu(false)" label="Save"></button>
                    </div>s
                </p-footer>
            </p-dialog>
        </div>
    </p-tabPanel>

    <!-- Báo cáo xuat -->
    <p-tabPanel header="Báo cáo Xuất">
        <!-- Search form -->
        <div class="row">
            <div class="p-col-1"></div>
            <div class="p-col-2">
                Kho: 
                <p-dropdown [options]="khoNhaps" optionLabel="name" 
                    (onChange)="changeKho()"
                    [(ngModel)]="selectedKhoXuat" name="khoXuat">
                </p-dropdown>
            </div>
            <div class="p-col-2">
                Khu:
                <p-dropdown [options]="khuXuats" optionLabel="name" 
                    [(ngModel)]="selectedKhuXuat" name="khuXuat">
                </p-dropdown>
            </div>
            <div class="p-col-2 label"  style="text-align: right;" >
                Chọn thuốc: 
            </div>
            <div class="p-col-4 row">
                <span class="ui-float-label">
                    <p-dropdown [options]="thuocs" 
                    optionLabel="maThuoc"
                    [(ngModel)]="selectedThuoc"
                        placeholder="Mã thuốc" filter="true"
                        >
                    </p-dropdown>
                </span>
                <span class="ui-float-label">
                    <p-dropdown [options]="thuocs" optionLabel="tenThuoc"
                        [(ngModel)]="selectedThuoc"
                        placeholder="Tên thuốc" filter="true"
                         >
                    </p-dropdown>
                </span>
            </div>
        </div>
        <br>
        <div class="row">
            <div class="p-col-2"></div>
            <div class="p-col-3">
                Từ:
                <p-calendar [(ngModel)]="xuatFrom" [showIcon]="true"
                dateFormat="dd/mm/yy"
                ></p-calendar>
            </div>
            <div class="p-col-3">
                Đến:
                <p-calendar [(ngModel)]="xuatTo" [showIcon]="true"
                dateFormat="dd/mm/yy"
                [minDate]="xuatFrom"
                ></p-calendar>
            </div>
            <div class="p-col-4">
                <button type="button" pButton icon="fa fa-check" 
                    (click)="xemThongkeXuat()" label="Xem"></button>
            </div>
        </div>
        <br>
        <!-- table -->
        <div class="p-grid">
            <p-table #dtXuatRP [columns]="colsExport" [value]="listExportModel" 
                [autoLayout]="true"
                selectionMode="single" 
                [loading]="searching"
                [(selection)]="exSelected"
                 [paginator]="true" [rows]="25">
                <ng-template pTemplate="caption">
                    <div *ngIf="selectedThuoc">
                        <label class="pipe">Tổng xuất: {{exportTotal | number}}  Tồn: {{toncu | number}} {{selectedThuoc.unit}}</label>
                        <!-- Tổng xuất: {{exportTotal}}, Tồn: {{toncu}} {{selectedThuoc.unit}} -->
                    </div>
                    <!-- <div *ngIf="name">{{name}}, tổng: {{importTotal}}  </div> -->
                    <div class="ui-helper-clearfix" style="text-align: left">
                        Chi tiết danh sách đã xuất 
                        <button type="button" pButton icon="pi pi-file-excel" iconPos="left" label="EXCEL" 
                        (click)="exportBaocaoExcel()" style="margin-right: 0.5em; float:right" 
                        class="ui-button-success" ></button>
                    </div>
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                    </tr>
                    <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field">
                          <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                          <!-- <input *ngSwitchCase="'donthuocjs'" pInputText type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')"> -->
                          <input *ngSwitchCase="'maphieu'" pInputText type="text"
                            (input)="dtXuatRP.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                          (input)="dtXuatRP.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'kho_name'" pInputText type="text"
                            (input)="dtXuatRP.filter($event.target.value, col.field, 'contains')">
                            <input *ngSwitchCase="'khu_name'" pInputText type="text"
                            (input)="dtXuatRP.filter($event.target.value, col.field, 'contains')">
                        </th>
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td *ngFor="let col of columns">
                            <div *ngIf="col.field=='exported_at'">
                                {{rowData[col.field] | date:'dd/MM/yyy'}}
                            </div>
                            <div *ngIf="col.field!='exported_at'">
                                {{rowData[col.field]}}
                            </div>
                        </td>
                    </tr>
                </ng-template>
            </p-table>
        </div>
    </p-tabPanel>  
    
    <!-- Báo cáo nhập -->
    <p-tabPanel header="Báo cáo Nhập">
        <!-- Search form -->
        <div>
            <div>
                <div class="row">
                    <div class="p-col-2"></div>
                    <div class="p-col-2">
                        Kho:
                        <p-dropdown [options]="khoNhaps" optionLabel="name" 
                            [(ngModel)]="selectedKhoNhap" name="khoNhap">
                        </p-dropdown>
                    </div>
                    <div class="p-col-1 label"  style="text-align: right;" >
                        Chọn thuốc: 
                    </div>
                    <div class="p-col-4 row">
                        <span class="ui-float-label">
                            <p-dropdown [options]="thuocs" optionLabel="maThuoc"
                            [(ngModel)]="selectedThuoc"
                                placeholder="Mã thuốc" filter="true"
                                >
                            </p-dropdown>
                        </span>
                        <span class="ui-float-label">
                            <p-dropdown [options]="thuocs" optionLabel="tenThuoc"
                                [(ngModel)]="selectedThuoc"
                                placeholder="Tên thuốc" filter="true"
                                 >
                            </p-dropdown>
                        </span>
                    </div>
                </div>
            </div>
            <br>
            <div class="row">
                <div class="p-col-2"></div>
                <div class="p-col-3">
                    Từ:
                    <p-calendar [(ngModel)]="nhapFrom" [showIcon]="true"
                    dateFormat="dd/mm/yy"
                    ></p-calendar>
                </div>
                <!-- <div class="p-col-1">
                </div> -->
                <div class="p-col-3">
                    Đến:
                    <p-calendar [(ngModel)]="nhapTo" [showIcon]="true"
                    dateFormat="dd/mm/yy"
                    [minDate]="nhapFrom"
                    ></p-calendar>
                </div>
                <div class="p-col-3">
                    <button type="button" pButton icon="fa fa-check" 
                        (click)="xemNhap(true)" label="Xem"></button>
                </div>
            </div>
        </div>
        <br>
        <div>
            <p-table #dtNhap [columns]="colsImport"
            [loading]="searching"
            [autoLayout]="true"
             [value]="listImportModel" selectionMode="single" 
            [(selection)]="imSelected" 
            [paginator]="true" [rows]="25">
            <ng-template pTemplate="caption">
                <div *ngIf="selectedThuoc">
                    <label class="pipe">Tổng nhập: {{importTotal | number}}  Tồn: {{toncu | number}} {{selectedThuoc.unit}}</label>
                    <!-- Tổng xuất: {{exportTotal}}, Tồn: {{toncu}} {{selectedThuoc.unit}} -->
                </div>
                <div class="ui-helper-clearfix" style="text-align: left">
                    Chi tiết danh sách đã nhập 
                    <button type="button" pButton icon="pi pi-file-excel" iconPos="left" label="EXCEL" 
                    (click)="exportBaocaoExcel(false)" style="margin-right: 0.5em; float:right" 
                    class="ui-button-success" ></button>
                </div>
            </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                        {{col.header}}
                        <p-sortIcon [field]="col.field"></p-sortIcon>
                    </th>
                </tr>
                <tr>
                    <th *ngFor="let col of columns" [ngSwitch]="col.field">
                      <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                      <!-- <input *ngSwitchCase="'donthuocjs'" pInputText type="text"
                        (input)="dt.filter($event.target.value, col.field, 'contains')"> -->
                      <input *ngSwitchCase="'maphieu'" pInputText type="text"
                        (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                      <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                      (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                      <input *ngSwitchCase="'kho_name'" pInputText type="text"
                        (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-columns="columns">
                <tr [pSelectableRow]="rowData">
                    <td *ngFor="let col of columns">
                        <div *ngIf="col.field=='imported_at' || col.field=='ngayhh'">
                            {{rowData[col.field] | date:'dd/MM/yyy'}}
                        </div>
                        <div *ngIf="col.field!='imported_at' && col.field!='ngayhh'">
                            {{rowData[col.field]}}
                        </div>
    
                    </td>
                </tr>
            </ng-template>
            </p-table>
        </div>
    </p-tabPanel> 

    <!-- Xem het -->
    <p-tabPanel header="Thống kê Nhập và xuất" >
        <br>
        <div class="p-grid">
            <p-table #dt [columns]="colsAll"
                [autoLayout]="true"
                [loading]="searching"
                 [value]="listAllPhieus" selectionMode="single" 
                 [paginator]="true" [rows]="25">
                <ng-template pTemplate="caption">
                    Chi tiết danh sách đã nhập 
                    <!-- <div *ngIf="name">{{name}}, tổng: {{importTotal}}  </div> -->
                </ng-template>
                <ng-template pTemplate="header" let-columns>
                    <tr>
                        <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                            {{col.header}}
                            <p-sortIcon [field]="col.field"></p-sortIcon>
                        </th>
                    </tr>
                    <tr>
                        <th *ngFor="let col of columns" [ngSwitch]="col.field">
                          <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                          <!-- <input *ngSwitchCase="'donthuocjs'" pInputText type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')"> -->
                          <input *ngSwitchCase="'maphieu'" pInputText type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                          (input)="dt.filter($event.target.value, col.field, 'contains')">
                          <input *ngSwitchCase="'kho_name'" pInputText type="text"
                            (input)="dt.filter($event.target.value, col.field, 'contains')">
                        </th>
                      </tr>
                </ng-template>
                <ng-template pTemplate="body" let-rowData let-columns="columns">
                    <tr [pSelectableRow]="rowData">
                        <td *ngFor="let col of columns">
                            <div *ngIf="col.field=='imported_at' || col.field=='ngayhh'">
                                {{rowData[col.field] | date:'dd/MM/yyy'}}
                            </div>
                            <div *ngIf="col.field!='imported_at' && col.field!='ngayhh'">
                                {{rowData[col.field]}}
                            </div>

                        </td>
                    </tr>
                </ng-template>
            </p-table>
            

        </div>

    </p-tabPanel>

    <!-- Xem het -->
    <p-tabPanel header="Thống kê Hạn sử dụng" >
        <br>
        <!-- table -->
        <div class="p-grid">
            <p-table #dtNhap [columns]="colsHSD"
            [loading]="searching"
            [autoLayout]="true"
             [value]="listHSD" selectionMode="single" 
            [(selection)]="imSelected" 
            [paginator]="true" [rows]="25">
            <ng-template pTemplate="caption">
                Chi tiết danh sách đã nhập 
                <!-- <div *ngIf="name">{{name}}, tổng: {{importTotal}}  </div> -->
            </ng-template>
            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th *ngFor="let col of columns" [pSortableColumn]="col.field">
                        {{col.header}}
                        <p-sortIcon [field]="col.field"></p-sortIcon>
                    </th>
                </tr>
                <tr>
                    <th *ngFor="let col of columns" [ngSwitch]="col.field">
                      <div *ngSwitchCase="'ngayhh'"> ngày/tháng/năm</div>
                      <!-- <input *ngSwitchCase="'donthuocjs'" pInputText type="text"
                        (input)="dt.filter($event.target.value, col.field, 'contains')"> -->
                      <input *ngSwitchCase="'maphieu'" pInputText type="text"
                        (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                      <input *ngSwitchCase="'tenthuoc'" pInputText type="text"
                      (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                      <input *ngSwitchCase="'kho_name'" pInputText type="text"
                        (input)="dtNhap.filter($event.target.value, col.field, 'contains')">
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-rowData let-index let-columns="columns">
                <tr [pSelectableRow]="rowData" [ngStyle]="rowData['css']">
                    <td *ngFor="let col of columns">
                        <div *ngIf="col.field=='imported_at' || col.field=='ngayhh'">
                            {{rowData[col.field] | date:'dd/MM/yyy'}}
                        </div>
                        <div *ngIf="col.field!='imported_at' && col.field!='ngayhh'">
                            {{rowData[col.field]}}
                        </div>
    
                    </td>
                </tr>
            </ng-template>
            </p-table>
        </div>

    </p-tabPanel>
</p-tabView>
